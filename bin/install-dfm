#!/bin/bash

# Ask the user if they want to install dfm
read -p "Do you want to install dfm? (y/n): " answer

# Check the user's answer
if [[ "$answer" != "y" ]]; then
    echo "Installation aborted by the user."
    exit 0
fi

# Define the .dfm directory path
dfm_dir="$HOME/.dfm"

# Check if the .dfm directory exists
if [[ -d "$dfm_dir" ]]; then
    echo ".dfm directory already exists, aborting."
    exit 1
fi

# Attempt to clone the dfm repository
if ! git clone https://github.com/xilixio/df.git "$dfm_dir"; then
    echo "Failed installing dfm. Error: Could not clone the repository."
    exit 1
fi

# Determine the user's default shell and its configuration file
shell_config_file=""
case "$SHELL" in
    */bash)
        shell_config_file="$HOME/.bashrc"
        ;;
    */zsh)
        shell_config_file="$HOME/.zshrc"
        ;;
    *)
        echo "Unsupported shell. Only bash and zsh are supported."
        exit 1
        ;;
esac

# Append the PATH export to the shell configuration file
if ! echo 'export PATH="$PATH:'"$dfm_dir"'/bin"' >> "$shell_config_file"; then
    echo "Failed installing dfm. Error: Could not update shell configuration."
    exit 1
fi

echo "Successfully installed dfm."
