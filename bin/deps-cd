#!/bin/bash

declare -A package_deps_seen

check_deps() {
    local package=$1
    local path="$2"

    local new_path="${path}->${package}"

    if [[ "$path" =~ "->${package}" ]]; then
        echo "A cyclic dependency involving '$package' was found in the path '$new_path'."
        exit 1
    fi

    package_deps_seen["$package"]=true

    mapfile -t deps < <(bin/df deps-list "$package")

    for dep in "${deps[@]}"; do
        check_deps "$dep" "$new_path"
    done
}

package="$1"

if [ -n "$package" ]; then
    check_deps "$package" "<root>"
else
    mapfile -t packages < <(bin/df list)

    for package in "${packages[@]}"; do
        check_deps "$package" "<root>"
    done
fi



exit 0